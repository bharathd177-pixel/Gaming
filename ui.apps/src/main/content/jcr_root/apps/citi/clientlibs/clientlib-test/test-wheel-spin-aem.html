<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel Spin Game Test - AEM Version</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .debug-info { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <h1>ğŸ¡ Wheel Spin Game Test Page - AEM Version</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ Instructions</h2>
        <div class="status warning">
            <strong>Important:</strong> This page uses AEM's clientlib system. 
            The citi.base clientlib should automatically load all required scripts.
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ Manual Testing</h2>
        <button onclick="testDependencies()">Test Dependencies</button>
        <button onclick="inspectGamificationComponents()">Inspect GamificationComponents</button>
        <button onclick="forceInit()">Force Initialize</button>
        <button onclick="checkContainer()">Check Container</button>
        <button onclick="clearConsole()">Clear Console</button>
        <button onclick="loadClientlib()">Load Clientlib Manually</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š Status</h2>
        <div id="status-container">
            <div class="status warning">Click "Test Dependencies" to check status</div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ Component Test</h2>
        <!-- Configuration data -->
        <div class="wsg-cmp-default" 
             data-wsg-title="Test Wheel Spin Game"
             data-wsg-button-text="SPIN!"
             data-wsg-spinning-text="Spinning..."
             data-wsg-wheel-size="400"
             data-wsg-animation-duration="3000"
             data-wsg-min-revolutions="3"
             data-wsg-max-revolutions="5"
             data-wsg-full-width="false">
        </div>
        
        <!-- Segments data -->
        <script type="application/json" id="wheel-spin-game-segments">
            [
                {"text":"ğŸ Free Gift","color":"#FF6B6B","value":"Free Gift"},
                {"text":"ğŸ’° $10 Cash","color":"#4ECDC4","value":"$10 Cash"},
                {"text":"ğŸ¯ 50% Off","color":"#45B7D1","value":"50% Off"},
                {"text":"ğŸª Try Again","color":"#96CEB4","value":"Try Again"},
                {"text":"ğŸ† Grand Prize","color":"#FFEAA7","value":"Grand Prize"},
                {"text":"ğŸ¨ Mystery Box","color":"#DDA0DD","value":"Mystery Box"}
            ]
        </script>
        
        <!-- React component container -->
        <div id="wheel-spin-game-container" class="loading">
            <div class="spinner"></div>
            Loading Wheel Spin Game...
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ Debug Information</h2>
        <div id="debug-info" class="debug-info">
            <div>Page loaded at: <span id="load-time"></span></div>
            <div>Script loaded: <span id="script-status">Unknown</span></div>
            <div>Container found: <span id="container-status">Unknown</span></div>
            <div>Initialization status: <span id="init-status">Unknown</span></div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ” Detailed Analysis</h2>
        <div id="analysis-container">
            <div class="status warning">Click "Inspect GamificationComponents" to see detailed analysis</div>
        </div>
    </div>

    <script>
        // Update load time
        document.getElementById('load-time').textContent = new Date().toISOString();
        
        // Test dependencies
        function testDependencies() {
            console.log('ğŸ§ª Testing dependencies...');
            
            const deps = {
                React: typeof window.React,
                ReactDOM: typeof window.ReactDOM,
                GamificationComponents: typeof window.GamificationComponents,
                SpinWheel: window.GamificationComponents && typeof window.GamificationComponents.SpinWheel,
                WheelSpinGameDebug: typeof window.WheelSpinGameDebug
            };
            
            console.log('ğŸ“‹ Dependencies:', deps);
            
            let statusHtml = '';
            let allGood = true;
            
            for (const [name, available] of Object.entries(deps)) {
                const status = available ? 'success' : 'error';
                const icon = available ? 'âœ…' : 'âŒ';
                const statusText = available ? 'Available' : 'Missing';
                statusHtml += '<div class="status ' + status + '">' + icon + ' ' + name + ': ' + statusText + '</div>';
                if (!available) allGood = false;
            }
            
            if (allGood) {
                statusHtml += '<div class="status success">ğŸ‰ All dependencies are available!</div>';
            } else {
                statusHtml += '<div class="status error">âŒ Some dependencies are missing</div>';
            }
            
            document.getElementById('status-container').innerHTML = statusHtml;
            
            // Update debug info
            document.getElementById('script-status').textContent = deps.WheelSpinGameDebug ? 'Loaded' : 'Not loaded';
        }
        
        // Inspect GamificationComponents in detail
        function inspectGamificationComponents() {
            console.log('ğŸ” Inspecting GamificationComponents...');
            
            let analysisHtml = '';
            
            if (window.GamificationComponents) {
                const keys = Object.keys(window.GamificationComponents);
                console.log('ğŸ“¦ GamificationComponents keys:', keys);
                
                analysisHtml += '<div class="status success">âœ… GamificationComponents is available</div>';
                analysisHtml += '<div class="status success">ğŸ“¦ Available components: ' + keys.join(', ') + '</div>';
                
                // Check each component
                keys.forEach(key => {
                    const component = window.GamificationComponents[key];
                    const type = typeof component;
                    const isFunction = typeof component === 'function';
                    
                    console.log('ğŸ”§ ' + key + ':', type, component);
                    
                    if (key === 'SpinWheel') {
                        analysisHtml += '<div class="status success">ğŸ¡ SpinWheel found! Type: ' + type + '</div>';
                        if (isFunction) {
                            analysisHtml += '<div class="status success">âœ… SpinWheel is a function (React component)</div>';
                        }
                    }
                    
                    analysisHtml += '<div class="status info" style="background: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb;">ğŸ”§ ' + key + ': ' + type + '</div>';
                });
                
                // Try to access SpinWheel specifically
                if (window.GamificationComponents.SpinWheel) {
                    analysisHtml += '<div class="status success">ğŸ¯ SpinWheel component is accessible!</div>';
                    console.log('ğŸ¯ SpinWheel component:', window.GamificationComponents.SpinWheel);
                } else {
                    analysisHtml += '<div class="status error">âŒ SpinWheel component not found in GamificationComponents</div>';
                }
                
            } else {
                analysisHtml += '<div class="status error">âŒ GamificationComponents is not available</div>';
                console.error('âŒ GamificationComponents not found');
            }
            
            document.getElementById('analysis-container').innerHTML = analysisHtml;
        }
        
        // Force initialization
        function forceInit() {
            console.log('ğŸ”§ Forcing initialization...');
            
            if (window.WheelSpinGameDebug && window.WheelSpinGameDebug.forceInit) {
                window.WheelSpinGameDebug.forceInit();
                document.getElementById('init-status').textContent = 'Forced';
            } else {
                console.error('âŒ WheelSpinGameDebug not available');
                document.getElementById('init-status').textContent = 'Debug not available';
            }
        }
        
        // Check container
        function checkContainer() {
            console.log('ğŸ” Checking container...');
            
            const container = document.getElementById('wheel-spin-game-container');
            const configElement = document.querySelector('.wsg-cmp-default');
            const segmentsScript = document.querySelector('#wheel-spin-game-segments');
            
            const status = {
                container: !!container,
                configElement: !!configElement,
                segmentsScript: !!segmentsScript,
                containerLoading: container && container.classList.contains('loading')
            };
            
            console.log('ğŸ“¦ Container status:', status);
            
            let statusHtml = '';
            for (const [name, available] of Object.entries(status)) {
                const statusClass = available ? 'success' : 'error';
                const icon = available ? 'âœ…' : 'âŒ';
                const statusText = available ? 'Found' : 'Missing';
                statusHtml += '<div class="status ' + statusClass + '">' + icon + ' ' + name + ': ' + statusText + '</div>';
            }
            
            document.getElementById('status-container').innerHTML = statusHtml;
            document.getElementById('container-status').textContent = status.container ? 'Found' : 'Not found';
        }
        
        // Clear console
        function clearConsole() {
            console.clear();
            console.log('ğŸ§¹ Console cleared');
        }
        
        // Load clientlib manually
        function loadClientlib() {
            console.log('ğŸ“š Loading citi.base clientlib manually...');
            
            // Create script elements to load the clientlib
            const scripts = [
                '/etc.clientlibs/citi/clientlibs/clientlib-base/react.production.min.js',
                '/etc.clientlibs/citi/clientlibs/clientlib-base/react-dom.production.min.js',
                '/etc.clientlibs/citi/clientlibs/clientlib-base/gamification-components.umd.js',
                '/etc.clientlibs/citi/clientlibs/clientlib-base/wheel-spin-game-integration.js'
            ];
            
            scripts.forEach((src, index) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => console.log('âœ… Loaded:', src);
                script.onerror = () => console.error('âŒ Failed to load:', src);
                document.head.appendChild(script);
            });
            
            // Test after a delay
            setTimeout(() => {
                testDependencies();
                inspectGamificationComponents();
            }, 2000);
        }
        
        // Auto-check on load
        window.addEventListener('load', function() {
            setTimeout(function() {
                testDependencies();
                inspectGamificationComponents();
                checkContainer();
            }, 2000); // Increased delay to ensure all scripts load
        });
        
        // Check for script loading
        let scriptCheckCount = 0;
        const scriptCheckInterval = setInterval(function() {
            scriptCheckCount++;
            
            if (window.WheelSpinGameDebug) {
                document.getElementById('script-status').textContent = 'Loaded';
                clearInterval(scriptCheckInterval);
            } else if (scriptCheckCount >= 20) {
                document.getElementById('script-status').textContent = 'Not loaded after 10 seconds';
                clearInterval(scriptCheckInterval);
            }
        }, 500);
        
        // Log when scripts start loading
        console.log('ğŸ“„ AEM Test page loaded, waiting for dependencies...');
    </script>
</body>
</html>
